{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
  <h3 class="mb-4 text-center"><i class="fas fa-box"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h3>

  <!-- ‚úÖ –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
  <form action="{{ url_for('add_product') }}" method="POST" enctype="multipart/form-data" class="row g-3 mb-4">
    <div class="col-md-4">
      <input type="text" name="name" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" required>
    </div>
    <div class="col-md-2">
      <input type="number" name="price" class="form-control" placeholder="–¶–µ–Ω–∞ ($)" step="0.01" min="0" required>
    </div>
    <div class="col-md-3">
      <input type="file" name="image" class="form-control" accept="image/*">
    </div>
    <div class="col-md-3">
      <button type="submit" class="btn btn-success w-100">
        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
      </button>
    </div>
  </form>

  <!-- üîç –ü–æ–∏—Å–∫ -->
  <div class="mb-4 text-center">
    <input type="text" id="searchInput" class="form-control w-75 mx-auto shadow-sm" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ —Ç–æ–≤–∞—Ä–∞–º...">
  </div>

  <!-- üîπ –í–∫–ª–∞–¥–∫–∏ -->
  <ul class="nav nav-tabs mb-3" id="productTabs">
    <li class="nav-item">
      <a class="nav-link active" data-bs-toggle="tab" href="#active-products">
        <i class="fas fa-box-open"></i> –ê–∫—Ç–∏–≤–Ω—ã–µ
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-bs-toggle="tab" href="#archived-products">
        <i class="fas fa-archive"></i> –ê—Ä—Ö–∏–≤
      </a>
    </li>
  </ul>

  <div class="tab-content">
    <!-- üì¶ –ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã -->
    <div class="tab-pane fade show active" id="active-products">
      <div class="product-grid">
        {% for product in products if not product.is_archived %}
        <div class="product-card" data-name="{{ product.name|lower }}">
          <!-- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
          {% if product.image and product.image != '' %}
            <img 
              src="{{ url_for('static', filename=product.image | replace_slashes) }}" 
              alt="{{ product.name }}" 
              class="product-img" 
              loading="lazy"
              onerror="this.onerror=null; this.src='https://via.placeholder.com/400x220/f1f5f9/94a3b8?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';">
          {% else %}
            <div class="product-img no-image">
              <i class="fas fa-image"></i>
              <span>–ù–µ—Ç —Ñ–æ—Ç–æ</span>
            </div>
          {% endif %}
          
          <div class="card-body text-center">
            <h6 class="product-name">{{ product.name }}</h6>
            <p class="product-price">${{ "%.2f" | format(product.price) }}</p>
            
            <form action="{{ url_for('edit_product', product_id=product.id) }}" method="POST" enctype="multipart/form-data" class="mb-2">
              <input type="text" name="name" class="form-control form-control-sm mb-1" placeholder="–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" value="{{ product.name }}">
              <input type="number" name="price" class="form-control form-control-sm mb-1" placeholder="–ù–æ–≤–∞—è —Ü–µ–Ω–∞" step="0.01" min="0" value="{{ product.price }}">
              <input type="file" name="image" class="form-control form-control-sm mb-2" accept="image/*">
              <button class="btn btn-sm btn-outline-primary w-100">
                <i class="fas fa-edit"></i> –ò–∑–º–µ–Ω–∏—Ç—å
              </button>
            </form>

            <a href="{{ url_for('archive_product', product_id=product.id) }}" 
               class="btn btn-sm btn-outline-warning w-100 mb-1"
               onclick="return confirm('–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∞—Ä—Ö–∏–≤?')">
              <i class="fas fa-archive"></i> –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å
            </a>
            <a href="{{ url_for('delete_product', product_id=product.id) }}" 
               class="btn btn-sm btn-outline-danger w-100"
               onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')">
              <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
            </a>
          </div>
        </div>
        {% else %}
          <div class="empty-state">
            <i class="fas fa-box-open"></i>
            <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç</p>
            <small>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É –≤—ã—à–µ</small>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- üì¶ –ê—Ä—Ö–∏–≤ -->
    <div class="tab-pane fade" id="archived-products">
      <div class="product-grid">
        {% for product in products if product.is_archived %}
        <div class="product-card archived" data-name="{{ product.name|lower }}">
          <!-- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
          {% if product.image and product.image != '' %}
            <img 
              src="{{ url_for('static', filename=product.image | replace_slashes) }}" 
              alt="{{ product.name }}" 
              class="product-img grayscale"
              loading="lazy"
              onerror="this.onerror=null; this.src='https://via.placeholder.com/400x220/f1f5f9/94a3b8?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';">
          {% else %}
            <div class="product-img no-image grayscale">
              <i class="fas fa-image"></i>
              <span>–ù–µ—Ç —Ñ–æ—Ç–æ</span>
            </div>
          {% endif %}
          
          <div class="card-body text-center">
            <h6 class="product-name text-muted">{{ product.name }}</h6>
            <p class="product-price text-muted">${{ "%.2f" | format(product.price) }}</p>
            <a href="{{ url_for('unarchive_product', product_id=product.id) }}" 
               class="btn btn-sm btn-outline-success w-100"
               onclick="return confirm('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∞—Ä—Ö–∏–≤–∞?')">
              <i class="fas fa-undo"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
            </a>
          </div>
        </div>
        {% else %}
          <div class="empty-state">
            <i class="fas fa-archive"></i>
            <p>–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç</p>
            <small>–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç</small>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<!-- üé® –°—Ç–∏–ª–∏ -->
<style>
.product-grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
  padding: 10px 0;
}

.product-card {
  flex: 0 0 calc(50% - 10px);
  max-width: 300px;
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  overflow: hidden;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  display: flex;
  flex-direction: column;
}

.product-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.product-card.archived {
  opacity: 0.7;
}

.product-img {
  width: 100%;
  height: 180px;
  object-fit: cover;
  background: #f3f4f6;
}

.no-image {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
  color: #9ca3af;
}

.no-image i {
  font-size: 3rem;
  margin-bottom: 8px;
}

.no-image span {
  font-size: 0.9rem;
  font-weight: 500;
}

.card-body {
  padding: 12px;
  flex: 1;
  display: flex;
  flex-direction: column;
}

.product-name {
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 5px;
  color: #1f2937;
}

.product-price {
  font-size: 14px;
  color: #10b981;
  font-weight: 600;
  margin-bottom: 10px;
}

.grayscale {
  filter: grayscale(100%);
}

.empty-state {
  width: 100%;
  text-align: center;
  padding: 60px 20px;
  color: #9ca3af;
}

.empty-state i {
  font-size: 4rem;
  margin-bottom: 15px;
  opacity: 0.5;
}

.empty-state p {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 5px;
  color: #6b7280;
}

.empty-state small {
  color: #9ca3af;
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã */
.form-control-sm {
  font-size: 0.85rem;
  padding: 6px 10px;
}

/* –ö–Ω–æ–ø–∫–∏ */
.btn-sm {
  font-size: 0.85rem;
  padding: 6px 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
}

/* –í–∫–ª–∞–¥–∫–∏ */
.nav-tabs .nav-link {
  color: #6b7280;
  border: none;
  padding: 10px 20px;
}

.nav-tabs .nav-link.active {
  color: #667eea;
  border-bottom: 2px solid #667eea;
  background: transparent;
}

.nav-tabs .nav-link:hover {
  border-color: transparent;
  color: #667eea;
}

/* –ü–æ–∏—Å–∫ */
#searchInput {
  border-radius: 25px;
  padding: 12px 20px;
  border: 2px solid #e5e7eb;
  transition: all 0.3s;
}

#searchInput:focus {
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* üì± –ú–æ–±–∏–ª—å–Ω—ã–π –∞–¥–∞–ø—Ç–∏–≤ */
@media (max-width: 768px) {
  .product-card {
    flex: 0 0 calc(50% - 10px);
    max-width: none;
  }

  .product-img, .no-image {
    height: 140px;
  }

  .card-body {
    padding: 8px;
  }

  .product-name {
    font-size: 13px;
  }

  .product-price {
    font-size: 13px;
  }

  .btn-sm {
    font-size: 11px;
    padding: 5px 8px;
  }

  .form-control-sm {
    font-size: 0.8rem;
    padding: 5px 8px;
  }

  .no-image i {
    font-size: 2rem;
  }

  .no-image span {
    font-size: 0.75rem;
  }
}

@media (max-width: 480px) {
  .container {
    padding: 10px;
  }

  h3 {
    font-size: 1.3rem;
  }

  .product-img, .no-image {
    height: 120px;
  }
}
</style>

<!-- üîç JS-–ø–æ–∏—Å–∫ -->
<script>
document.getElementById('searchInput').addEventListener('input', function () {
  const search = this.value.trim().toLowerCase();
  const activeTab = document.querySelector('.tab-pane.active');
  const cards = activeTab.querySelectorAll('.product-card');
  let visibleCount = 0;

  cards.forEach(card => {
    const name = card.dataset.name;
    const isVisible = name.includes(search);
    card.style.display = isVisible ? 'flex' : 'none';
    if (isVisible) visibleCount++;
  });

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
  const emptyState = activeTab.querySelector('.empty-state');
  if (emptyState) {
    emptyState.style.display = visibleCount === 0 && search !== '' ? 'block' : 'none';
  }
});

// –°–±—Ä–æ—Å –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tab => {
  tab.addEventListener('shown.bs.tab', function () {
    document.getElementById('searchInput').value = '';
    document.querySelectorAll('.product-card').forEach(card => {
      card.style.display = 'flex';
    });
  });
});
</script>

{% endblock %}